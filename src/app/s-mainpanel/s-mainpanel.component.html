<!DOCTYPE html>
<head>
    <title>Departements</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600&amp;subset=cyrillic,latin">
    <link rel="stylesheet" href="../../assets/plugins/bootstrap/css/bootstrap-rtl.min.css">
    <link rel="stylesheet" href="../../assets/css/css-rtl/style-rtl.css">
    <link rel="stylesheet" href="../../assets/css/css-rtl/headers/header-default-rtl.css">
    <link rel="stylesheet" href="../../assets/css/css-rtl/footers/footer-v1-rtl.css">
    <link rel="stylesheet" href="../../assets/plugins/animate.css">
    <link rel="stylesheet" href="../../assets/plugins/line-icons/line-icons.css">
    <link rel="stylesheet" href="../../assets/css/plugins/style-switcher.css">
    <link rel="stylesheet" href="../../assets/css/css-rtl/theme-colors/dark-blue.css" id="style_color">
    <link rel="stylesheet" href="../../assets/css/css-rtl/theme-skins/dark.css">
    <link rel="stylesheet" href="../../assets/css/css-rtl/rtl.css">
    <link rel="stylesheet" href="../../assets/plugins/sky-forms-pro/skyforms/css/sky-forms-rtl.css">
    <link rel="stylesheet" href="../../assets/plugins/sky-forms-pro/skyforms/custom/custom-sky-forms-rtl.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>	
<body> 
<div class="wrapper" style="background-image: url('../assets/img/breadcrumbs.png');">   
    <div class="breadcrumbs">
        <div class="container arabparagraph">
            <h1 class="pull-left"><span class="arabtext">المتابعة</span></h1>
        </div>
    </div>
</div> 
    

<div class="container content ">
  <br/><br/>
  <div class="panel">
      <div class="panel-heading">
        <div class="row arabparagraph" >
            <h3 class="panel-title">
                    <button *ngIf="!missdep" style="text-align: right;" (click)="toggleMissDep()" class="btn-u btn-u-lg btn-block btn-u-dark-blue" type="button"><i class="fa fa-chevron-right"></i> <span class="arabparagraph">المأموريات المنجزة من طرف المؤسسة </span> <span class="pull-right"> <i class="fa fa-home"></i></span></button>
                    <button *ngIf="missdep" style="text-align: right;" (click)="toggleMissDep()" class="btn-u btn-u-lg btn-block btn-u-dark-blue" type="button"><i class="fa fa-chevron-down"></i> <span class="arabparagraph">المأموريات المنجزة من طرف المؤسسة </span> <span class="pull-right"> <i class="fa fa-home"></i></span></button>        
            </h3>
        </div>
    </div>
    <div class="arabparagraph" *ngIf="missdep">
    <form   id="sky-form1" class="sky-form " >
        <div class="row">
            <br/>
            <section class="col col-1.5"></section>
            <section class="col col-1.5">
                <p class="arabparagraph">
                        من
                </p> 
            </section>
            <section class="col col-3">
                <label class="input"><i class="icon-prepend fa fa-calendar"></i>
                    <input type="date" #a (change)="chDate()" [(ngModel)]="deball" name="de">
                </label>
            </section>
            <section class="col col-1.5">
                    <p class="arabparagraph">
                            إلى
                    </p> 
                </section>
                <section class="col col-3">
                        <label class="input"><i class="icon-prepend fa fa-calendar"></i>
                            <input type="date" #c [(ngModel)]="finall" (change)="chDate()" name="a">
                        </label>
                </section>   
            <section class="col col-3">
                <button type="button" (click)="print1()" class="btn btn-u"><i class="fa fa-print"></i>  </button>
            </section>
        </div>
    </form>
  </div>
  </div>

  <div class="panel">
        <div class="panel-heading">
          <div class="row arabparagraph" >
              <h3 class="panel-title">
                    <button *ngIf="!distrpays" (click)="distrpays = true"style="text-align: right;" class="btn-u btn-u-lg btn-block btn-u-red" type="button"><i class="fa fa-chevron-right"></i> <span class="arabparagraph">توزيع المأموريات حسب البلدان</span> <span class="pull-right"> <i class="fa fa-list-ol"></i></span></button>
                    <button *ngIf="distrpays" (click)="distrpays = false" style="text-align: right;" class="btn-u btn-u-lg btn-block btn-u-red" type="button"><i class="fa fa-chevron-down"></i> <span class="arabparagraph">توزيع المأموريات حسب البلدان</span> <span class="pull-right"> <i class="fa fa-list-ol"></i></span></button>
                </h3>
          </div>
      </div>
      <div class="arabparagraph" *ngIf="distrpays">
      <form   id="sky-form1" class="sky-form " >
          <div class="row">
              <br/>
              <section class="col col-1.5"></section>
              <section class="col col-1.5">
                  <p class="arabparagraph">
                          من
                  </p> 
              </section>
              <section class="col col-3">
                  <label class="input"><i class="icon-prepend fa fa-calendar"></i>
                      <input type="date" #dd name="de" [(ngModel)]="deb" (change)="cc.value&&dd.value && ff.value?chCountry():return">
                  </label>
              </section>
              <section class="col col-1.5">
                      <p class="arabparagraph">
                              إلى
                      </p> 
                  </section>
                  <section class="col col-3">
                          <label class="input"><i class="icon-prepend fa fa-calendar"></i>
                              <input type="date" #ff name="a"  [(ngModel)]="fin" (change)="cc.value&&dd.value && ff.value?chCountry():return">
                          </label>
                  </section>
                  <section class="col col-1.5">
                        <p class="arabparagraph">
                                البلد
                        </p> 
                    </section>
                    <section class="col col-2">
                            <label class="select">
                                <select name="pays" #cc [(ngModel)]="selectedPays" #p (change)="cc.value&&dd.value && ff.value && p.value?chCountry():return">
                                    <option *ngFor="let p of listPays" [ngValue]="p">{{p.libPaysAr}}</option>
                                </select>
                                <i></i>
                            </label>
                    </section>   
              <section class="col col-2">
                  <button type="button" (click)="showCountries()" class="btn-u btn-u-red"><i class="fa fa-print"></i>  </button>
              </section>
          </div>
          <div class="row">
                <div style="display: block;">
                        <canvas baseChart 
                                    [data]="doughnutChartData"
                                    [labels]="doughnutChartLabels"
                                    [chartType]="doughnutChartType"
                                    ></canvas>
                      </div>
            </div>
            <br/>
            <div class="row">
                <agm-map   [zoom]="2"  id="regions_div">
                    <agm-marker  *ngFor="let m of markers; let i = index" [iconUrl]="'../../assets/img/marker.png'" [latitude]="m.lat" [label]="{color: 'red',fontFamily: 'monospace',fontSize: '13', fontWeight: '100',text: m.label}" [longitude]="m.lng"></agm-marker>
                  </agm-map>
            </div>
      </form>
    </div>
    </div>

    <div class="panel">
            <div class="panel-heading">
              <div class="row arabparagraph" >
                  <h3 class="panel-title">
                        <button *ngIf="!bilan"  (click)="bilan = true" style="text-align: right;" class="btn-u btn-u-lg btn-block btn btn-u-sea" type="button"><i class="fa fa-chevron-right"></i> <span class="arabparagraph">بيان حول استهلاك الإعتمادات</span>  <span class="pull-right"> <i class="fa  fa-list-alt"></i></span></button>
                        <button *ngIf="bilan" (click)="bilan = false" style="text-align: right;" class="btn-u btn-u-lg btn-block btn btn-u-sea" type="button"><i class="fa fa-chevron-down"></i> <span class="arabparagraph">بيان حول استهلاك الإعتمادات</span>  <span class="pull-right"> <i class="fa  fa-list-alt"></i></span></button>
                    </h3>
              </div>
          </div>
          <div class="arabparagraph" *ngIf="bilan">
          <form   id="sky-form1" class="sky-form " >
                <fieldset>
              <div class="row">
                  <br/>
                  <section class="col col-2"></section>        
                  <section class="col col-2"></section>
                  <section class="col col-1.5">
                      <p class="arabparagraph">
                            السنة
                      </p> 
                  </section>
                  <section class="col col-3">
                      <label class="select">
                          <select name="yearconcernee" (change)="chYear()" [(ngModel)]="choosenyear">
                              <option *ngFor="let a of anneesAdministratives" [ngValue]="a">{{a}}</option>
                          </select><i></i>
                      </label>
                  </section>    
                  <section class="col col-3">
                      <button type="button" (click)="bilanDepenses()" class="btn-u btn-u-sea"><i class="fa fa-print"></i> طباعة البيان</button>
                  </section>
              </div>
              <br/><br/>
              <div class="row">
                    <h1 class="arabtext text-center"> <span class="arabtext">إستهلاك اعتمادات الهيكل للسنة {{d.getFullYear()}}</span></h1>
                </div>
                <br/><br/><br/>
              <div class="row">
                    <div class="col-md-6" >
                            <span class="text-center"> إستهلاك الإعتمادات المخصصة للمأمورية </span>
                      <canvas baseChart style="width: 600px;height: 600px;"
                              [labels]="barChartLabels"
                              [datasets]="barChartData"
                              [options]="barChartOptions"
                              [legend]="barChartLegend"
                              [chartType]="barChartType">
                          </canvas>
                      </div>
                      <section class="col-md-6"  >إستهلاك الإعتمادات المخصصة للنقل 
                            <canvas baseChart  style="width: 600px;height: 600px;"
                                    [labels]="barChartLabels"
                                    [datasets]="barChartData2"
                                    [options]="barChartOptions"
                                    [legend]="barChartLegend"
                                    [chartType]="barChartType">
                                </canvas>
                            </section>
                </div>
                <br/><br/>
                <div class="row">
                        <h1 class="arabtext text-center"> <span class="arabtext">إستهلاك اعتمادات المشاريع للسنة :  {{d.getFullYear()}}</span></h1>
                    </div>
                    <br/><br/><br/>
                  
                  <div class="row" *ngIf=" loaded == true">
                        <div class="col-md-12">
                          <div style="display: block;">
                          <canvas baseChart width="650" height="200" *ngIf="loaded == true"
                                      [datasets]="lineChartData"
                                      [labels]="lineChartLabels"
                                      [options]="lineChartOptions"
                                      [legend]="lineChartLegend"
                                      [chartType]="lineChartType"></canvas>
                          </div>
                        </div>
                    </div>
            </fieldset>

          </form>
        </div>
        </div>

</div> 

<!-- printing tempalte pays + deb + fin-->
<div id="print-section" style="display: none;">
        <p>الجمهورية التونسية
                <br/> {{this.currentDep.libDepAr}}</p>
                <h1 style="text-align:center;">
                المأموريات المنجزة حسب البلد 
                </h1>
                <h3 style="text-align:center;">
                 من {{this.deb}} إلى {{this.fin}}</h3>    
           <h2 style="text-align:center;">
           البلد : {{this.selectedPays.libPaysAr}}
           </h2>
           <table>
                <tr>
                  <th>المأمورية</th>
                  <th>رقم الهوية / المعرف الوحيد</th>
                  <th>الاسم واللقب </th>
                  <th>تاريخ الذهاب</th>
                  <th>تاريخ الإياب</th>
                  <th>المدة</th>
                  <th>موضوع المأمورية</th>
                  <th>مصاريف المأمورية</th>
                  <th>مصاريف النقل</th>
                  <th>مصاريف أخرى</th>
                  <th>الوضعية</th>
                </tr>
               <tr *ngFor="let a of missionsres ">
                    <td>{{a.mission.numMission}}</td>
                    <td>{{a.missionaire.matricule}}</td>
                    <td>{{a.missionaire.nomAr + "  "+ a.missionaire.prenomAr}}</td>
                    <td>{{a.mission.dateDepartP}}</td>
                    <td>{{a.mission.dateArriveP}}</td>
                    <td>{{convDur(a.mission.dateDepartP,a.mission.dateArriveP)}}</td>
                    <td>{{a.mission.objectifMissionAr}}</td>
                    <td>{{getFraisMission(a.avoirfrais)}}</td>
                    <td>{{getFraisTransp(a.avoirfrais)}}</td>
                    <td>{{getFraisDivers(a.avoirfrais)}}</td>
                    <td>{{affichageEtat(a.etat)}}</td>
               </tr>
               <tfoot>
                   <tr>
                       <td colspan="12">
                            &nbsp;&nbsp;&nbsp;
                            مجموع المهمات &nbsp;&nbsp; :&nbsp;  {{missionsres.length}} 
                            &nbsp;&nbsp;
                            مجموع عدد الأيام &nbsp;&nbsp; :&nbsp; {{totaljours}}
                            &nbsp;&nbsp;
                            مجموع مصاريف المأموريات &nbsp;:&nbsp; {{totalmiss}} د
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            مجموع المصاريف الأخرى &nbsp;:&nbsp; {{totaldivers}} د
                            &nbsp;&nbsp;
                            مجموع مصاريف النقل &nbsp;&nbsp;:&nbsp; {{totaltransport}} د
                       </td>
                   </tr>
               </tfoot>
            </table>

</div>
<!-- end template pays + deb + fin-->

<!-- begin template deb + fin-->
<div id="dates-only" style="display: none;">
    <p>الجمهورية التونسية
        <br/> {{this.currentDep.libDepAr}}</p>
        <h1 style="text-align:center;">
        المأموريات المنجزة من قبل الهيكل   
        </h1>
        <h3 style="text-align:center;">
         من {{deball}} إلى {{finall}}
        </h3>    
   <table>
        <tr>
          <th>المأمورية</th>
          <th>بطاقة التعريف</th>
          <th>الاسم واللقب </th>
          <th>موضوع المأمورية</th>
          <th>تاريخ الذهاب</th>
          <th>تاريخ الإياب</th>
          <th>المكان</th>
          <th>المدة</th>
          <th>مصاريف المأمورية</th>
          <th>مصاريف النقل</th>
          <th>مصاريف أخرى</th>
          <th>الوضعية</th>
        </tr>
       <tr *ngFor="let a of mismissionres2 ">
            <td>{{a.mission.numMission}}</td>
            <td>{{a.missionaire.cin}}</td>
            <td>{{a.missionaire.prenomAr + "  "+ a.missionaire.nomAr}}</td>
            <td>{{a.mission.objectifMissionAr}}</td>
            <td>{{a.mission.dateDepartP}}</td>
            <td>{{a.mission.dateArriveP}}</td>
            <!--<td>{{destinations}}</td>-->
            <td><span *ngFor="let r of a.concerne">{{r!=undefined?r.pays.libPaysAr:return}} - </span></td>
            <td>{{convDur(a.mission.dateDepartP,a.mission.dateArriveP)}}</td>
            <td>{{getFraisMission(a.avoirfrais)}}</td>
            <td>{{getFraisTransp(a.avoirfrais)}}</td>
            <td>{{getFraisDivers(a.avoirfrais)}}</td>
            <td>{{affichageEtat(a.etat)}}</td>
       </tr>
       <tfoot>
           <tr>
               <td colspan="12">
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    مجموع المهمات &nbsp;&nbsp;&nbsp; :&nbsp;  {{mismissionres2.length}} 
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    مجموع عدد الأيام &nbsp;&nbsp; :&nbsp; {{totaljours}}
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    مجموع مصاريف المأموريات &nbsp;:&nbsp; {{totalmiss}} د
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    مجموع المصاريف الأخرى &nbsp;:&nbsp; {{totaldivers}} د
                    &nbsp;&nbsp;
                    مجموع مصاريف النقل &nbsp;&nbsp;:&nbsp;&nbsp; {{totaltransport}} د
               </td>
           </tr>
       </tfoot>
    </table>
</div>
<!-- end template deb + fin -->
<!-- bilan depenses -->
<div id="bilan" style="display: none;text-align: center;">
    <h1 style="text-align:center;">بيان حول استهلاك الإعتمادات</h1>
    <h2 style="text-align:center;">لسنة : {{choosenyear}}</h2>
    <table style="margin-right: 285px;">
        <tr style="text-align:center;">
            <td style="visibility: hidden;"></td>
            <td>الإعتمادات المخصصة</td>
            <td>الإعتمادات المستهلكة</td>
            <td>الإعتمادات المتبقية</td>
        </tr>
        <tr style="text-align:center;">
            <td>مصاريف المامورية</td>
            <td>{{fraisMObt}}</td>
            <td>{{fraisMConsom}}</td>
            <td>{{fraisMObt - fraisMConsom}}</td>
        </tr>
        <tr style="text-align:center;">
            <td>مصاريف النقل</td>
            <td>{{fraisTObt}}</td>
            <td>{{fraisTConsom}}</td>
            <td>{{fraisTObt - fraisTConsom}}</td>
        </tr>
    </table>
    <br/>
    <table>
        <tr>
            <td colspan="5" style="visibility: hidden;"></td>
            <td colspan="3">مصاريف المأمورية</td>
            <td colspan="2" style="visibility: hidden;"></td>

        </tr>
        <tr style="text-align:center;">
            <td>الاسم واللقب</td>
            <td>رقم المهمة</td>
            <td>الموضوع</td>
            <td>المدة </td>
            <td>المكان</td>
            <td>مصاريف المأمورية</td>
            <td>مصاريف أخرى </td>
            <td>المجموع</td>
            <td>مصاريف النقل</td>
            <td>الوضعية</td>
        </tr>
        <tr style="text-align:center;" *ngFor="let l of lstOrdres">
            <td>{{l.missionaire.prenomAr + " " + l.missionaire.nomAr}}</td>
            <td>  {{l.numOrdre}} {{l.mission.numMission}} / {{dep.codeDep}}  </td>
            <td>{{l.mission.objectifMissionAr}}</td>
            <td>{{l.mission.dateDepartP}}<br/>{{l.mission.dateArriveP}} </td>
            <td><span *ngFor="let r of l.concerne">{{r!=undefined?r.pays.libPaysAr:return}} - </span></td>
            <!--<td>{{getCountries(l.concerne)}}</td>-->
            <td>
                {{getFraisMission(l.avoirfrais)}}
            </td>
            <td>
               {{getFraisDivers(l.avoirfrais)}}
            </td>
            <td>
                    {{getTotal(l.avoirfrais)}}
            </td>
            <td>
                    {{getFraisTransp(l.avoirfrais)>0?getFraisTransp(l.avoirfrais):0 }}
            </td>
            <td>{{affichageEtat(l.etat)}}</td>
        </tr>
        <tfoot>
            <tr>
                <td style="visibility: hidden;" colspan="4"></td>
                <td>المجموع</td>
                <td>{{totalMission}}</td>
                <td>{{totalAutres}}</td>
                <td>{{totalAutres + totalMission}}</td>
                <td>{{totalTransport}}</td>
                <td style="visibility: hidden;"></td>
            </tr>
        </tfoot>
    </table>
</div>
<!--end bilan-->

<!-- End Order Form -->
<!-- JS Global Compulsory -->			
<script src="../../assets/plugins/jquery/jquery.min.js"></script>
<script src="../../assets/plugins/jquery/jquery-migrate.min.js"></script>
<script src="../../assets/plugins/bootstrap/js/bootstrap.min.js"></script>
<!-- JS Implementing Plugins -->
<script src="../../assets/plugins/back-to-top.js"></script>
<script src="../../assets/plugins/smoothScroll.js"></script>
<script src="../../assets/plugins/jquery.parallax.js"></script>
<!-- JS Customization -->
<script src="../../assets/js/custom.js"></script>
<!-- JS Page Level -->           
<script src="../../assets/js/app.js"></script>
<script src="../../assets/js/plugins/style-switcher-rtl.js"></script>
<script>
    jQuery(document).ready(function() {
      	App.init();
        StyleSwitcher.initStyleSwitcher();        
    });
    
</script>
</body>

